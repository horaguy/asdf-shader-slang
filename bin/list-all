#!/usr/bin/env bash
set -euo pipefail

GH_REPO="shader-slang/slang"
GH_API="https://api.github.com/repos/${GH_REPO}/releases?per_page=1000"

# Minimum supported version in this plugin
MIN_VERSION="2024.1.27"

version_ge() {
  # $1 >= $2 ?
  [ "$(printf '%s\n' "$2" "$1" | sort -V | head -n1)" = "$2" ]
}

main() {
  curl -fsSL "${GH_API}" \
    | grep -oE '"tag_name": *"v[0-9\.]+"' \
    | sed -E 's/.*"v([0-9\.]+)".*/\1/' \
    | while read -r v; do
        if version_ge "$v" "$MIN_VERSION"; then
          echo "$v"
        fi
      done
}

main "$@"
